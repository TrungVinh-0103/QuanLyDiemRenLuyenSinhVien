@model List<QLDiemRenLuyen.Models.PhieuDanhGia>
@{
    ViewData["Title"] = "Danh sách phiếu đánh giá";
    Layout = "~/Views/Shared/_LayoutGiaoVien.cshtml";
}
<link rel="stylesheet" href="~/css/DanhSachPhieu.css" />

<div class="teacher-container">
    <div class="container">
        <div class="content-card">
            <!-- Page Header -->
            <div class="page-header">
                <h4>
                    <i class="fas fa-clipboard-list me-3"></i>
                    DANH SÁCH PHIẾU ĐANG CHỜ DUYỆT
                </h4>
            </div>

            @if (Model.Any())
            {
                <!-- Stats Cards -->
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-number">@Model.Count</div>
                        <div class="stat-label">Tổng phiếu chờ</div>
                    </div>
                </div>
                <!-- Search Box -->
                <input type="text" class="form-control search-box" placeholder="Tìm kiếm theo tên sinh viên, lớp..." id="searchInput">

                <!-- Table -->
                <div class="table-responsive">
                    <table class="modern-table" id="evaluationTable">
                        <thead>
                            <tr>
                                <th>
                                    <i class="fas fa-user me-2"></i>
                                    Sinh viên
                                </th>
                                <th>
                                    <i class="fas fa-users me-2"></i>
                                    Lớp
                                </th>
                                <th>
                                    <i class="fas fa-calendar me-2"></i>
                                    Học kỳ
                                </th>
                                <th>
                                    <i class="fas fa-star me-2"></i>
                                    Điểm tự đánh giá
                                </th>
                                <th>
                                    <i class="fas fa-cogs me-2"></i>
                                    Thao tác
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var p in Model)
                            {
                                <tr style="animation: fadeInUp 0.6s ease; animation-delay: @(Model.IndexOf(p) * 0.1)s;">
                                    <td>
                                        <div class="student-info">
                                            <div class="student-avatar">
                                                @(p.SinhVien?.HoTen?.Substring(0, 1).ToUpper())
                                            </div>
                                            <div>
                                                <strong>@p.SinhVien?.HoTen</strong>
                                                <br>
                                                <small class="text-muted">@p.SinhVien?.MaSV</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="class-badge">@p.SinhVien?.Lop?.TenLop</span>
                                    </td>
                                    <td>
                                        <div class="semester-info">
                                            @p.HocKy?.TenHocKy - @p.HocKy?.NamHoc
                                        </div>
                                    </td>
                                    <td>
                                        <span class="score-badge">
                                            @p.TongDiemTuDanhGia điểm
                                        </span>
                                    </td>
                                    <td>
                                        <a asp-action="DuyetPhieu" asp-route-id="@p.PhieuDanhGiaID"
                                           class="approve-btn">
                                            <i class="fas fa-check me-2"></i>
                                            Duyệt phiếu
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="empty-state">
                    <i class="fas fa-clipboard-check"></i>
                    <h5>Không có phiếu nào cần duyệt</h5>
                    <p>Tất cả phiếu đánh giá đã được xử lý hoặc chưa có sinh viên nào gửi phiếu.</p>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Search functionality
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('#evaluationTable tbody tr');

            tableRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                    row.style.animation = 'fadeIn 0.3s ease';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Add loading effect to approve buttons
        document.querySelectorAll('.approve-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Đang xử lý...';
                this.style.pointerEvents = 'none';
            });
        });

        // Animation for table rows
        document.addEventListener('DOMContentLoaded', function() {
            const rows = document.querySelectorAll('.modern-table tbody tr');
            rows.forEach((row, index) => {
                row.style.animationDelay = `${index * 0.1}s`;
            });
        });
    </script>
}
